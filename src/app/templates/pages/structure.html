<div
  class="flex h-screen flex-col bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark"
  data-suffix-root
  data-image-id="{{ image_id or '' }}"
>
  <header
    class="w-full border-b border-border-light dark:border-border-dark bg-card-light dark:bg-card-dark h-16"
  >
    <div
      class="grid h-full w-full grid-cols-3 items-center px-4 sm:px-6 lg:px-8"
    >
      <div class="flex justify-start gap-2">
        <a
          href="{% if image_id %}{{ url_for('site.overview', id=image_id) }}{% else %}{{ url_for('site.overview') }}{% endif %}"
          class="inline-flex items-center gap-2 rounded-full border border-border-light dark:border-border-dark px-4 py-2 text-sm font-semibold transition-colors hover:border-primary hover:text-primary"
        >
          <span class="material-symbols-outlined text-base">arrow_back</span>
          Back to overview
        </a>
        <a
          href="{{ url_for('site.home') }}"
          class="inline-flex h-10 w-10 items-center justify-center rounded-full border border-border-light dark:border-border-dark text-text-light dark:text-text-dark transition-colors hover:border-primary hover:text-primary focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary"
          aria-label="Home"
          title="Home"
        >
          <span class="material-symbols-outlined text-xl leading-none"
            >home</span
          >
        </a>
        <a
          href="{{ url_for('site.collection') }}"
          class="inline-flex h-10 w-10 items-center justify-center rounded-full border border-border-light dark:border-border-dark text-text-light dark:text-text-dark transition-colors hover:border-primary hover:text-primary focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary"
          aria-label="Collection"
          title="Collection"
        >
          <span class="material-symbols-outlined text-xl leading-none"
            >apps</span
          >
        </a>
      </div>
      <div class="flex items-center justify-center gap-3">
        <div class="size-8"></div>
        <h2
          class="text-2xl font-bold text-primary leading-tight tracking-[-0.015em] select-none"
          style="font-family: &quot;Caesar Dressing&quot;, cursive"
        >
          GlyPat
        </h2>
      </div>
      <div class="flex items-center justify-end">
        <button
          id="themeToggle"
          type="button"
          class="inline-flex items-center justify-center rounded-full border border-border-light dark:border-border-dark p-2 text-text-light dark:text-text-dark transition-colors hover:border-primary hover:text-primary focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary"
          aria-pressed="false"
        >
          <span class="sr-only">Toggle color theme</span>
          <span
            class="material-symbols-outlined text-xl leading-none dark:hidden"
            >dark_mode</span
          >
          <span
            class="material-symbols-outlined hidden text-xl leading-none dark:inline"
            >light_mode</span
          >
        </button>
      </div>
    </div>
  </header>

  <main
    class="flex-1 overflow-hidden min-h-0 p-6 grid grid-cols-4 gap-6 h-[calc(100vh-64px)] relative"
    data-suffix-overlay-container
  >
     <!-- Column 1: Stable sequences (top) + Stable stems (bottom) -->
    <div class="col-span-2 flex flex-col gap-6 h-full min-h-0">
      <section
        class="flex-1 bg-white dark:bg-card-dark rounded-xl border border-slate-200 dark:border-border-dark flex flex-col overflow-hidden"
      >
        <div
          class="p-4 border-b border-slate-200 dark:border-border-dark flex justify-between items-center bg-slate-50/50 dark:bg-slate-800/30"
        >
          <h3 class="font-bold flex items-center gap-2">
            <span class="material-symbols-outlined text-blue-500 text-base"
              >link</span
            >
            Most Occurring Patterns
            <button
              type="button"
              class="tooltip-trigger inline-flex h-5 w-5 items-center justify-center rounded-full border border-primary/40 bg-primary/10 text-[11px] font-bold text-primary shadow-sm cursor-help focus:outline-none focus:ring-2 focus:ring-primary/40"
              data-tooltip="Top 10 patterns with the highest frequency in this image."
            >
              ?
            </button>
          </h3>
        </div>
        <div class="flex-1 overflow-auto">
          <table class="w-full text-left border-collapse">
            <thead class="bg-slate-50 dark:bg-slate-900 sticky top-0 z-20">
              <tr>
                <th
                  class="px-4 py-3 text-xs font-semibold text-slate-500 uppercase bg-slate-50 dark:bg-slate-900 z-10"
                >
                  Sequence
                </th>
                <th
                  class="px-4 py-3 text-xs font-semibold text-slate-500 uppercase text-center bg-slate-50 dark:bg-slate-900 z-10"
                >
                  Frequency
                </th>
                <th
                  class="px-4 py-3 text-xs font-semibold text-slate-500 uppercase text-center bg-slate-50 dark:bg-slate-900 z-10"
                >
                  Analyse
                </th>
              </tr>
            </thead>
            <tbody
              class="divide-y divide-slate-100 dark:divide-border-dark"
              data-suffix-stable-body
            ></tbody>
          </table>
        </div>
      </section>

      <section
        class="flex-1 bg-white dark:bg-card-dark rounded-xl border border-slate-200 dark:border-border-dark flex flex-col overflow-hidden"
      >
        <div
          class="p-4 border-b border-slate-200 dark:border-border-dark bg-slate-50/50 dark:bg-slate-800/30 flex justify-between items-center"
        >
          <h3 class="font-bold flex items-center gap-2">
            <span class="material-symbols-outlined text-amber-500 text-base"
              >splitscreen</span
            >
            Stable Stems
            <button
              type="button"
              class="tooltip-trigger inline-flex h-5 w-5 items-center justify-center rounded-full border border-primary/40 bg-primary/10 text-[11px] font-bold text-primary shadow-sm cursor-help focus:outline-none focus:ring-2 focus:ring-primary/40"
              data-tooltip="Internal stems with highest repeat-per-length and consistent boundaries."
            >
              ?
            </button>
          </h3>
        </div>
        <div class="flex-1 overflow-auto">
          <table class="w-full text-left border-collapse">
            <thead class="bg-slate-50 dark:bg-slate-900 sticky top-0 z-20">
              <tr>
                <th
                  class="px-4 py-3 text-xs font-semibold text-slate-500 uppercase bg-slate-50 dark:bg-slate-900"
                >
                  Stem
                </th>
                <th
                  class="px-4 py-3 text-xs font-semibold text-slate-500 uppercase text-center bg-slate-50 dark:bg-slate-900"
                >
                  Frequency
                </th>
                <th
                  class="px-4 py-3 text-xs font-semibold text-slate-500 uppercase bg-slate-50 dark:bg-slate-900"
                >
                  <span class="inline-flex items-center gap-1">
                    Stability
                    <button
                      type="button"
                      class="tooltip-trigger inline-flex h-4 w-4 items-center justify-center rounded-full border border-primary/40 bg-primary/10 text-[10px] font-bold text-primary shadow-sm cursor-help focus:outline-none focus:ring-2 focus:ring-primary/40"
                      data-tooltip="Score = ln(1+c) · (1+productivity) · (1+boundary); compares stems within this image."
                    >
                      ?
                    </button>
                  </span>
                </th>
                <th
                  class="px-4 py-3 text-xs font-semibold text-slate-500 uppercase text-center bg-slate-50 dark:bg-slate-900"
                >
                  <span class="inline-flex items-center gap-1 justify-center">
                    Productivity
                    <button
                      type="button"
                      class="tooltip-trigger inline-flex h-4 w-4 items-center justify-center rounded-full border border-primary/40 bg-primary/10 text-[10px] font-bold text-primary shadow-sm cursor-help focus:outline-none focus:ring-2 focus:ring-primary/40"
                      data-tooltip="Distinct contexts: (#unique left) + (#unique right) around the stem."
                    >
                      ?
                    </button>
                  </span>
                </th>
                <th
                  class="px-4 py-3 text-xs font-semibold text-slate-500 uppercase text-center bg-slate-50 dark:bg-slate-900"
                >
                  <span class="inline-flex items-center gap-1 justify-center">
                    Boundary
                    <button
                      type="button"
                      class="tooltip-trigger inline-flex h-4 w-4 items-center justify-center rounded-full border border-primary/40 bg-primary/10 text-[10px] font-bold text-primary shadow-sm cursor-help focus:outline-none focus:ring-2 focus:ring-primary/40"
                      data-tooltip="Average entropy of left/right context distributions; higher = more even boundaries."
                    >
                      ?
                    </button>
                  </span>
                </th>
                <th
                  class="px-4 py-3 text-xs font-semibold text-slate-500 uppercase text-center bg-slate-50 dark:bg-slate-900"
                >
                  Analyse
                </th>
              </tr>
            </thead>
            <tbody
              class="divide-y divide-slate-100 dark:divide-border-dark"
              data-suffix-stem-body
            ></tbody>
          </table>
        </div>
      </section>
    </div>

    <!-- Column 2: Prefixes (top) + Suffixes (bottom) -->
    <div class="col-span-2 flex flex-col gap-6 h-full min-h-0">
      <section
        class="flex-1 bg-white dark:bg-card-dark rounded-xl border border-slate-200 dark:border-border-dark flex flex-col overflow-hidden"
      >
        <div
          class="p-4 border-b border-slate-200 dark:border-border-dark bg-slate-50/50 dark:bg-slate-800/30 flex justify-between items-center"
        >
          <h3 class="font-bold flex items-center gap-2">
            <span class="material-symbols-outlined text-green-500 text-base"
              >first_page</span
            >
            Most Prefixes
            <button
              type="button"
              class="tooltip-trigger inline-flex h-5 w-5 items-center justify-center rounded-full border border-primary/40 bg-primary/10 text-[11px] font-bold text-primary shadow-sm cursor-help focus:outline-none focus:ring-2 focus:ring-primary/40"
              data-tooltip="Share of patterns that start with each prefix sequence."
            >
              ?
            </button>
          </h3>
        </div>
        <div class="flex-1 overflow-auto">
          <table class="w-full text-left border-collapse">
            <thead class="bg-slate-50 dark:bg-slate-900 sticky top-0 z-20">
              <tr>
                <th
                  class="px-4 py-3 text-xs font-semibold text-slate-500 uppercase bg-slate-50 dark:bg-slate-900"
                >
                  Sequence
                </th>
                <th
                  class="px-4 py-3 text-xs font-semibold text-slate-500 uppercase text-center bg-slate-50 dark:bg-slate-900"
                >
                  Frequency
                </th>
                <th
                  class="px-4 py-3 text-xs font-semibold text-slate-500 uppercase text-center bg-slate-50 dark:bg-slate-900"
                >
                  %
                </th>
                <th
                  class="px-4 py-3 text-xs font-semibold text-slate-500 uppercase text-center bg-slate-50 dark:bg-slate-900"
                >
                  Analyse
                </th>
              </tr>
            </thead>
            <tbody
              class="divide-y divide-slate-100 dark:divide-border-dark"
              data-suffix-prefix-body
            ></tbody>
          </table>
        </div>
      </section>

      <section
        class="flex-1 bg-white dark:bg-card-dark rounded-xl border border-slate-200 dark:border-border-dark flex flex-col overflow-hidden"
      >
        <div
          class="p-4 border-b border-slate-200 dark:border-border-dark bg-slate-50/50 dark:bg-slate-800/30"
        >
          <h3 class="font-bold flex items-center gap-2">
            <span class="material-symbols-outlined text-orange-400 text-base"
              >last_page</span
            >
            Most Suffixes
            <button
              type="button"
              class="tooltip-trigger inline-flex h-5 w-5 items-center justify-center rounded-full border border-primary/40 bg-primary/10 text-[11px] font-bold text-primary shadow-sm cursor-help focus:outline-none focus:ring-2 focus:ring-primary/40"
              data-tooltip="Share of patterns that end with each suffix sequence."
            >
              ?
            </button>
          </h3>
        </div>
        <div class="flex-1 overflow-y-auto space-y-3">
          <table class="w-full text-left border-collapse">
            <thead class="bg-slate-50 dark:bg-slate-900 sticky top-0 z-20">
              <tr>
                <th
                  class="px-4 py-3 text-xs font-semibold text-slate-500 uppercase bg-slate-50 dark:bg-slate-900"
                >
                  Sequence
                </th>
                <th
                  class="px-4 py-3 text-xs font-semibold text-slate-500 uppercase text-center bg-slate-50 dark:bg-slate-900"
                >
                  Frequency
                </th>
                <th
                  class="px-4 py-3 text-xs font-semibold text-slate-500 uppercase text-center bg-slate-50 dark:bg-slate-900"
                >
                  %
                </th>
                <th
                  class="px-4 py-3 text-xs font-semibold text-slate-500 uppercase text-center bg-slate-50 dark:bg-slate-900"
                >
                  Analyse
                </th>
              </tr>
            </thead>
            <tbody
              class="divide-y divide-slate-100 dark:divide-border-dark"
              data-suffix-suffix-body
            ></tbody>
          </table>
        </div>
      </section>
    </div>
  </main>

  <div
    class="absolute inset-x-0 bottom-0 top-16 z-30 hidden flex items-center justify-center bg-background-light/85 dark:bg-background-dark/80 backdrop-blur-sm"
    data-suffix-loading
  >
    <div
      class="flex flex-col items-center gap-3 text-text-secondary-light dark:text-text-secondary-dark"
    >
      <div class="relative flex h-12 w-12" data-suffix-loading-spinner>
        <span
          class="animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"
        ></span>
        <span
          class="relative inline-flex h-12 w-12 rounded-full bg-primary/70"
        ></span>
      </div>
      <p
        class="text-sm font-semibold tracking-wide uppercase"
        data-suffix-loading-text
      >
        Loading…
      </p>
    </div>
  </div>
</div>
